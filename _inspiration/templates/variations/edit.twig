{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set title = variation.id ? "Variante bearbeiten" : "Neue Variante" %}
{% set crumbs = [
    { label: "Buchungen", url: url('booking') },
    { label: "Varianten", url: url('booking/variations') },
    { label: title }
] %}

{# Get default values from settings #}
{% set defaultSlotDuration = settings.defaultSlotDurationMinutes %}
{% set defaultBuffer = settings.defaultBufferMinutes %}

{% block content %}
    <form method="post" accept-charset="UTF-8">
        {{ csrfInput() }}
        <input type="hidden" name="action" value="booking/variations/save">
        {{ redirectInput('booking/variations') }}

        {% if variation.id %}
            <input type="hidden" name="id" value="{{ variation.id }}">
        {% endif %}

        <div class="fields">
            <div class="field" id="title-field">
                <div class="heading">
                    <label for="title" class="required">Name</label>
                </div>
                <div class="input ltr">
                    <input type="text" class="text fullwidth" id="title" name="title" value="{{ variation.title }}" required autofocus>
                </div>
                <div class="instructions">
                    <p>Der Name der Variante</p>
                </div>
            </div>

            <div class="field" id="description-field">
                <div class="heading">
                    <label for="description">Beschreibung</label>
                </div>
                <div class="input ltr">
                    <textarea class="text fullwidth" id="description" name="description" rows="4">{{ variation.description }}</textarea>
                </div>
                <div class="instructions">
                    <p>Optionale Beschreibung der Variante</p>
                </div>
            </div>

            <hr style="margin: 30px 0;">

            <div class="flex">
                <div class="field" id="slotDurationMinutes-field">
                    <div class="heading">
                        <label for="slotDurationMinutes">Slot-Dauer (Minuten)</label>
                    </div>
                    <div class="input ltr">
                        <input type="number" class="text" id="slotDurationMinutes" name="slotDurationMinutes" value="{{ variation.slotDurationMinutes }}" min="1" max="480" placeholder="{{ defaultSlotDuration }}">
                    </div>
                    <div class="instructions">
                        <p>Leer lassen für Standardwert ({{ defaultSlotDuration }} Minuten)</p>
                    </div>
                </div>

                <div class="field" id="bufferMinutes-field">
                    <div class="heading">
                        <label for="bufferMinutes">Pufferzeit (Minuten)</label>
                    </div>
                    <div class="input ltr">
                        <input type="number" class="text" id="bufferMinutes" name="bufferMinutes" value="{{ variation.bufferMinutes }}" min="0" max="120" placeholder="{{ defaultBuffer }}">
                    </div>
                    <div class="instructions">
                        <p>Leer lassen für Standardwert ({{ defaultBuffer }} Minuten)</p>
                    </div>
                </div>
            </div>

            <hr style="margin: 30px 0;">

            <div class="flex">
                <div class="field" id="maxCapacity-field">
                    <div class="heading">
                        <label for="maxCapacity" class="required">Maximale Kapazität</label>
                    </div>
                    <div class="input ltr">
                        <input type="number" class="text" id="maxCapacity" name="maxCapacity" value="{{ variation.maxCapacity ?: 1 }}" min="1" max="1000" required>
                    </div>
                    <div class="instructions">
                        <p>Maximale Anzahl gleichzeitiger Buchungen für einen Zeitslot</p>
                    </div>
                </div>

                <div class="field" id="allowQuantitySelection-field">
                    <div class="heading">
                        <label for="allowQuantitySelection">Mengenauswahl erlauben</label>
                    </div>
                    <div class="input ltr">
                        <input type="hidden" name="allowQuantitySelection" value="0">
                        <label class="checkbox-label">
                            <input type="checkbox" id="allowQuantitySelection" name="allowQuantitySelection" value="1" {{ variation.allowQuantitySelection ? 'checked' : '' }}>
                            <span>Benutzer können mehrere Plätze gleichzeitig buchen</span>
                        </label>
                    </div>
                    <div class="instructions">
                        <p>Erlaubt Benutzern, mehrere Plätze in einer Buchung zu reservieren</p>
                    </div>
                </div>
            </div>

            <hr style="margin: 30px 0;">

            <div class="field" id="isActive-field">
                <input type="hidden" name="isActive" value="0">
                <label>
                    <input type="checkbox" id="isActive" name="isActive" value="1" {{ variation.isActive ? 'checked' : '' }}>
                    Aktiv
                </label>
                <div class="instructions">
                    <p>Deaktivieren Sie diese Option, um diese Variante vorübergehend zu deaktivieren.</p>
                </div>
            </div>
        </div>

        <div class="buttons">
            <input type="submit" class="btn submit" value="Speichern">
        </div>
    </form>
{% endblock %}
