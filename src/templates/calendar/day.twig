{% extends "_layouts/cp" %}

{% set selectedSubnavItem = 'calendar' %}
{% set title = "Calendar - " ~ date|date('F d, Y') %}

{# Calculate previous and next day dates #}
{% set prevDay = date.format('Y-m-d')|date_modify('-1 day') %}
{% set nextDay = date.format('Y-m-d')|date_modify('+1 day') %}

{% block content %}
    <div style="display: grid; grid-template-columns: 280px 1fr; gap: 24px;">
        {# Sidebar with mini calendar #}
        <div>
            {% include 'booked/calendar/_mini-calendar' with {
                selectedDate: selectedDate,
                view: 'day',
                bookingCounts: bookingCounts
            } %}
        </div>

        {# Main calendar view #}
        <div>
            <div class="calendar-header">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <a href="{{ url('booked/calendar-view/day', {
                            date: prevDay|date('Y-m-d')
                        }) }}" class="btn">← Previous Day</a>

                        <a href="{{ url('booked/calendar-view/day') }}" class="btn">Today</a>

                        <a href="{{ url('booked/calendar-view/day', {
                            date: nextDay|date('Y-m-d')
                        }) }}" class="btn">Next Day →</a>
                    </div>

                    <div>
                        <a href="{{ url('booked/calendar-view/month') }}" class="btn">Month View</a>
                        <a href="{{ url('booked/calendar-view/week') }}" class="btn">Week View</a>
                    </div>
                </div>
            </div>

            <div class="day-schedule" style="max-width: 800px;">
        {% for hour, reservations in hourlySlots %}
            <div style="display: flex; border-bottom: 1px solid #e5e7eb; min-height: 60px;">
                <div style="width: 80px; padding: 12px; font-weight: bold; color: #6b7280; flex-shrink: 0;">
                    {{ hour }}
                </div>

                <div style="flex: 1; padding: 8px;">
                    {% if reservations|length > 0 %}
                        {% for reservation in reservations %}
                            <div style="padding: 8px 12px; margin: 4px 0; background:
                                {% if reservation.status == 'confirmed' %}#d1fae5
                                {% elseif reservation.status == 'pending' %}#fef3c7
                                {% elseif reservation.status == 'cancelled' %}#fee2e2
                                {% else %}#e5e7eb{% endif %};
                                border-left: 4px solid
                                {% if reservation.status == 'confirmed' %}#10b981
                                {% elseif reservation.status == 'pending' %}#f59e0b
                                {% elseif reservation.status == 'cancelled' %}#ef4444
                                {% else %}#9ca3af{% endif %};
                                border-radius: 4px;">
                                <div style="font-weight: bold; font-size: 14px;">
                                    {{ reservation.startTime }} - {{ reservation.endTime }}
                                </div>
                                <div style="font-size: 13px; margin-top: 4px;">
                                    Customer: {{ reservation.customerEmail }}
                                </div>
                                {% if reservation.serviceId %}
                                    <div style="font-size: 12px; color: #6b7280; margin-top: 2px;">
                                        Service ID: {{ reservation.serviceId }}
                                    </div>
                                {% endif %}
                                <div style="margin-top: 6px;">
                                    <a href="{{ url('booked/bookings/' ~ reservation.id) }}" class="btn small">View Details</a>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div style="color: #d1d5db; padding: 12px; font-style: italic; font-size: 13px;">
                            Available
                        </div>
                    {% endif %}
                </div>
                </div>
            {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
