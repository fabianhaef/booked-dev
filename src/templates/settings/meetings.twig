{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set selectedSubnavItem = 'settings' %}
{% set selectedSettingsSubnavItem = 'meetings' %}
{% set title = "Virtual Meetings"|t('booked') %}
{% set crumbs = [
    { label: 'Booked'|t('booked'), url: url('booked/services') },
    { label: 'Settings'|t('booked'), url: url('booked/settings') },
    { label: 'Virtual Meetings'|t('booked') }
] %}

{% set plugin = craft.app.plugins.getPlugin('booked') %}
{% set isPro = plugin.isEdition(constant('fabian\\booked\\Booked::EDITION_PRO')) %}

{% block sidebar %}
    {% include 'booked/settings/_sidebar' %}
{% endblock %}

{% block content %}
    {% include 'booked/_includes/pro-upgrade-notice' with { feature: 'Virtual Meetings' } %}

    <form method="post" accept-charset="UTF-8" id="settings-form">
        {{ csrfInput() }}
        <input type="hidden" name="action" value="booked/cp/settings/save">
        {{ redirectInput('booked/settings/meetings') }}

        <h2>{{ 'Virtual Meetings'|t('booked') }}</h2>
        <p class="light">{{ 'Configure automatic virtual meeting creation for bookings.'|t('booked') }}</p>

        <fieldset {% if not isPro %}disabled{% endif %}>
            {{ forms.lightswitchField({
                label: 'Enable Virtual Meetings'|t('booked'),
                instructions: 'Enable virtual meeting functionality for services.'|t('booked'),
                id: 'enableVirtualMeetings',
                name: 'settings[enableVirtualMeetings]',
                on: settings.enableVirtualMeetings,
                toggle: '#virtual-meeting-settings',
                disabled: not isPro
            }) }}

            <div id="virtual-meeting-settings" class="{% if not settings.enableVirtualMeetings %}hidden{% endif %}">
                <hr>
                <h3>{{ 'Zoom'|t('booked') }}</h3>

                {{ forms.lightswitchField({
                    label: 'Enable Zoom'|t('booked'),
                    id: 'zoomEnabled',
                    name: 'settings[zoomEnabled]',
                    on: settings.zoomEnabled,
                    disabled: not isPro
                }) }}

                {{ forms.textField({
                    label: 'Zoom Account ID'|t('booked'),
                    id: 'zoomAccountId',
                    name: 'settings[zoomAccountId]',
                    value: settings.zoomAccountId,
                    instructions: 'Required for Server-to-Server OAuth'|t('booked'),
                    disabled: not isPro
                }) }}

                {{ forms.textField({
                    label: 'Zoom Client ID'|t('booked'),
                    id: 'zoomClientId',
                    name: 'settings[zoomClientId]',
                    value: settings.zoomClientId,
                    disabled: not isPro
                }) }}

                {{ forms.passwordField({
                    label: 'Zoom Client Secret'|t('booked'),
                    id: 'zoomClientSecret',
                    name: 'settings[zoomClientSecret]',
                    value: settings.zoomClientSecret,
                    disabled: not isPro
                }) }}

                {{ forms.lightswitchField({
                    label: 'Auto-create Zoom Meetings'|t('booked'),
                    instructions: 'Automatically create Zoom meetings when bookings are confirmed.'|t('booked'),
                    id: 'zoomAutoCreate',
                    name: 'settings[zoomAutoCreate]',
                    on: settings.zoomAutoCreate,
                    disabled: not isPro
                }) }}

                <hr>

                <h3>{{ 'Google Meet'|t('booked') }}</h3>

                {{ forms.lightswitchField({
                    label: 'Enable Google Meet'|t('booked'),
                    id: 'googleMeetEnabled',
                    name: 'settings[googleMeetEnabled]',
                    on: settings.googleMeetEnabled,
                    disabled: not isPro
                }) }}

                {{ forms.lightswitchField({
                    label: 'Auto-create Google Meet Links'|t('booked'),
                    instructions: 'Automatically create Google Meet links when bookings are confirmed.'|t('booked'),
                    id: 'googleMeetAutoCreate',
                    name: 'settings[googleMeetAutoCreate]',
                    on: settings.googleMeetAutoCreate,
                    disabled: not isPro
                }) }}
            </div>
        </fieldset>

        {% if isPro %}
        <div class="buttons">
            <button type="submit" class="btn submit">{{ 'Save Settings'|t('booked') }}</button>
        </div>
        {% endif %}
    </form>
{% endblock %}
