{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set selectedSubnavItem = 'settings' %}
{% set selectedSettingsSubnavItem = 'notifications' %}
{% set title = "Notifications"|t('booked') %}
{% set crumbs = [
    { label: 'Booked'|t('booked'), url: url('booked/services') },
    { label: 'Settings'|t('booked'), url: url('booked/settings') },
    { label: 'Notifications'|t('booked') }
] %}

{% set plugin = craft.app.plugins.getPlugin('booked') %}
{% set isPro = plugin.isEdition(constant('fabian\\booked\\Booked::EDITION_PRO')) %}

{% block sidebar %}
    {% include 'booked/settings/_sidebar' %}
{% endblock %}

{% block content %}
    <form method="post" accept-charset="UTF-8" id="settings-form">
        {{ csrfInput() }}
        <input type="hidden" name="action" value="booked/cp/settings/save">
        {{ redirectInput('booked/settings/notifications') }}

        <h2>{{ 'Notifications'|t('booked') }}</h2>
        <p class="light">{{ 'Configure email and SMS notifications for bookings.'|t('booked') }}</p>

        <h3>{{ 'Email Notifications'|t('booked') }}</h3>

        {{ forms.lightswitchField({
            label: 'Enable Owner Notifications'|t('booked'),
            id: 'ownerNotificationEnabled',
            name: 'settings[ownerNotificationEnabled]',
            on: settings.ownerNotificationEnabled
        }) }}

        {{ forms.textField({
            label: 'Owner Email'|t('booked'),
            id: 'ownerEmail',
            name: 'settings[ownerEmail]',
            value: settings.ownerEmail,
            type: 'email'
        }) }}

        {{ forms.textField({
            label: 'Owner Name'|t('booked'),
            id: 'ownerName',
            name: 'settings[ownerName]',
            value: settings.ownerName
        }) }}

        {{ forms.textField({
            label: 'Owner Notification Subject'|t('booked'),
            id: 'ownerNotificationSubject',
            name: 'settings[ownerNotificationSubject]',
            value: settings.ownerNotificationSubject
        }) }}

        {{ forms.textField({
            label: 'Booking Confirmation Subject'|t('booked'),
            id: 'bookingConfirmationSubject',
            name: 'settings[bookingConfirmationSubject]',
            value: settings.bookingConfirmationSubject
        }) }}

        {{ forms.textareaField({
            label: 'Booking Confirmation Body'|t('booked'),
            instructions: 'Twig template for booking confirmation emails. Available variables: booking, customer, service, employee, location.'|t('booked'),
            id: 'bookingConfirmationBody',
            name: 'settings[bookingConfirmationBody]',
            value: settings.bookingConfirmationBody,
            rows: 10
        }) }}

        {{ forms.lightswitchField({
            label: 'Enable Email Reminders'|t('booked'),
            id: 'emailRemindersEnabled',
            name: 'settings[emailRemindersEnabled]',
            on: settings.emailRemindersEnabled
        }) }}

        {{ forms.textField({
            label: 'Email Reminder Hours Before'|t('booked'),
            instructions: 'Send reminder email this many hours before the appointment (default: 24).'|t('booked'),
            id: 'emailReminderHoursBefore',
            name: 'settings[emailReminderHoursBefore]',
            value: settings.emailReminderHoursBefore,
            type: 'number',
            min: 0
        }) }}

        {{ forms.lightswitchField({
            label: 'Send 1-Hour Reminder'|t('booked'),
            id: 'emailReminderOneHourBefore',
            name: 'settings[emailReminderOneHourBefore]',
            on: settings.emailReminderOneHourBefore
        }) }}

        <hr>

        <h3>
            {{ 'SMS Notifications'|t('booked') }}
            {% if not isPro %}
                {% include 'booked/_includes/edition-badge' with { edition: 'pro' } %}
            {% endif %}
        </h3>

        {% if not isPro %}
        <p class="light" style="color: #92400e;">
            {{ 'SMS notifications require the Pro edition.'|t('booked') }}
            <a href="https://plugins.craftcms.com/booked" target="_blank">{{ 'Learn more'|t('booked') }} â†’</a>
        </p>
        {% endif %}

        <fieldset {% if not isPro %}disabled{% endif %}>
            {{ forms.lightswitchField({
                label: 'Enable SMS Notifications'|t('booked'),
                id: 'smsEnabled',
                name: 'settings[smsEnabled]',
                on: settings.smsEnabled,
                disabled: not isPro
            }) }}

            {{ forms.selectField({
                label: 'SMS Provider'|t('booked'),
                id: 'smsProvider',
                name: 'settings[smsProvider]',
                value: settings.smsProvider,
                options: [
                    { label: 'Twilio'|t('booked'), value: 'twilio' }
                ],
                disabled: not isPro
            }) }}

            {{ forms.textField({
                label: 'Twilio Account SID'|t('booked'),
                id: 'twilioAccountSid',
                name: 'settings[twilioAccountSid]',
                value: settings.twilioAccountSid,
                disabled: not isPro
            }) }}

            {{ forms.passwordField({
                label: 'Twilio Auth Token'|t('booked'),
                id: 'twilioAuthToken',
                name: 'settings[twilioAuthToken]',
                value: settings.twilioAuthToken,
                disabled: not isPro
            }) }}

            {{ forms.textField({
                label: 'Twilio Phone Number'|t('booked'),
                instructions: 'Your Twilio phone number (e.g., +1234567890).'|t('booked'),
                id: 'twilioPhoneNumber',
                name: 'settings[twilioPhoneNumber]',
                value: settings.twilioPhoneNumber,
                disabled: not isPro
            }) }}

            {{ forms.lightswitchField({
                label: 'Enable SMS Reminders'|t('booked'),
                id: 'smsRemindersEnabled',
                name: 'settings[smsRemindersEnabled]',
                on: settings.smsRemindersEnabled,
                disabled: not isPro
            }) }}

            {{ forms.textField({
                label: 'SMS Reminder Hours Before'|t('booked'),
                instructions: 'Send reminder SMS this many hours before the appointment (default: 24).'|t('booked'),
                id: 'smsReminderHoursBefore',
                name: 'settings[smsReminderHoursBefore]',
                value: settings.smsReminderHoursBefore,
                type: 'number',
                min: 0,
                disabled: not isPro
            }) }}
        </fieldset>

        <div class="buttons">
            <button type="submit" class="btn submit">{{ 'Save Settings'|t('booked') }}</button>
        </div>
    </form>
{% endblock %}
