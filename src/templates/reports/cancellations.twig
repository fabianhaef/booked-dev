{% extends "_layouts/cp" %}

{% set title = "Cancellation Rate Report" %}

{% block content %}
    <div class="flex justify-between items-center mb-6">
        <h1>Cancellation Analysis</h1>
        <a href="{{ url('booked/reports') }}" class="btn">← Back to Reports</a>
    </div>

    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 32px;">
        <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 24px; text-align: center;">
            <div style="color: #6b7280; font-size: 14px; margin-bottom: 8px;">Total Bookings</div>
            <div style="font-size: 48px; font-weight: bold; color: #3b82f6;">{{ totalBookings }}</div>
        </div>

        <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 24px; text-align: center;">
            <div style="color: #6b7280; font-size: 14px; margin-bottom: 8px;">Cancelled Bookings</div>
            <div style="font-size: 48px; font-weight: bold; color: #ef4444;">{{ cancelledBookings }}</div>
        </div>

        <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 24px; text-align: center;">
            <div style="color: #6b7280; font-size: 14px; margin-bottom: 8px;">Cancellation Rate</div>
            <div style="font-size: 48px; font-weight: bold; color: {% if cancellationRate < 10 %}#10b981{% elseif cancellationRate < 20 %}#f59e0b{% else %}#ef4444{% endif %};">
                {{ cancellationRate|number_format(1) }}%
            </div>
        </div>
    </div>

    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 24px;">
        <h3 style="margin: 0 0 16px 0;">Cancellation Rate Indicator</h3>

        <div style="background: #e5e7eb; height: 24px; border-radius: 12px; overflow: hidden; position: relative;">
            <div style="position: absolute; left: 0; width: 33.33%; height: 100%; background: #10b981;"></div>
            <div style="position: absolute; left: 33.33%; width: 33.33%; height: 100%; background: #f59e0b;"></div>
            <div style="position: absolute; left: 66.66%; width: 33.34%; height: 100%; background: #ef4444;"></div>

            <div style="position: absolute; left: {{ cancellationRate > 30 ? 30 : cancellationRate }}%; top: -8px; transform: translateX(-50%);">
                <div style="width: 4px; height: 40px; background: #1f2937; border-radius: 2px;"></div>
                <div style="position: absolute; top: -24px; left: 50%; transform: translateX(-50%); white-space: nowrap; font-weight: 600; font-size: 14px; color: #1f2937;">
                    {{ cancellationRate|number_format(1) }}%
                </div>
            </div>
        </div>

        <div style="display: flex; justify-content: space-between; margin-top: 12px; font-size: 12px; color: #6b7280;">
            <div>0% (Excellent)</div>
            <div>10%</div>
            <div>20%</div>
            <div>30%+ (High)</div>
        </div>

        {% if cancellationRate > 20 %}
            <div style="margin-top: 24px; padding: 16px; background: #fee2e2; border-radius: 8px; border-left: 4px solid #ef4444;">
                <div style="font-weight: 600; color: #991b1b; margin-bottom: 4px;">⚠️ High Cancellation Rate</div>
                <div style="color: #7f1d1d; font-size: 14px;">
                    Your cancellation rate is above 20%. Consider implementing a cancellation policy or deposit system.
                </div>
            </div>
        {% elseif cancellationRate > 10 %}
            <div style="margin-top: 24px; padding: 16px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <div style="font-weight: 600; color: #92400e; margin-bottom: 4px;">⚡ Moderate Cancellation Rate</div>
                <div style="color: #78350f; font-size: 14px;">
                    Your cancellation rate is moderate. Monitor trends and consider reminder notifications.
                </div>
            </div>
        {% else %}
            <div style="margin-top: 24px; padding: 16px; background: #d1fae5; border-radius: 8px; border-left: 4px solid #10b981;">
                <div style="font-weight: 600; color: #065f46; margin-bottom: 4px;">✅ Low Cancellation Rate</div>
                <div style="color: #064e3b; font-size: 14px;">
                    Your cancellation rate is excellent! Keep up the good work.
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}
