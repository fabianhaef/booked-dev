{% extends "_layouts/cp" %}

{% set title = "Peak Hours Report" %}

{% block content %}
    <div class="flex justify-between items-center mb-6">
        <h1>Peak Hours Analysis</h1>
        <a href="{{ url('booked/reports') }}" class="btn">‚Üê Back to Reports</a>
    </div>

    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 24px;">
        <h3 style="margin: 0 0 20px 0;">Bookings by Hour of Day</h3>

        {% if hourlyBookings|length > 0 %}
            {% set maxBookings = max(hourlyBookings) %}

            <div style="display: grid; gap: 12px;">
                {% for hour, count in hourlyBookings %}
                    {% set percentage = maxBookings > 0 ? (count / maxBookings * 100) : 0 %}

                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div style="width: 80px; font-weight: 600; color: #374151;">
                            {{ '%02d:00'|format(hour) }}
                        </div>

                        <div style="flex: 1; position: relative;">
                            <div style="background: #e5e7eb; height: 36px; border-radius: 4px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, #8b5cf6 0%, #a78bfa 100%); height: 100%; width: {{ percentage }}%; display: flex; align-items: center; padding: 0 12px; color: white; font-weight: 600; font-size: 14px; transition: width 0.3s ease;">
                                    {% if percentage > 15 %}
                                        {{ count }} bookings
                                    {% endif %}
                                </div>
                            </div>
                            {% if percentage <= 15 and count > 0 %}
                                <div style="position: absolute; left: calc({{ percentage }}% + 8px); top: 50%; transform: translateY(-50%); font-weight: 600; color: #374151; font-size: 14px;">
                                    {{ count }} bookings
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>

            <div style="margin-top: 32px; padding: 20px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <div style="font-weight: 600; color: #92400e; margin-bottom: 8px;">Peak Hour Insights</div>
                <div style="color: #78350f; font-size: 14px;">
                    The busiest booking time is {{ hourlyBookings|keys|first }}:00 with {{ max(hourlyBookings) }} bookings.
                    Consider adding more staff during peak hours to handle demand.
                </div>
            </div>
        {% else %}
            <div style="text-align: center; color: #9ca3af; padding: 60px 0;">
                No hourly data available
            </div>
        {% endif %}
    </div>
{% endblock %}
