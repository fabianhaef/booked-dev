{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set selectedSubnavItem = 'schedules' %}
{% set title = schedule.id ? 'Edit Schedule'|t('booked') : 'New Schedule'|t('booked') %}
{% set crumbs = [
    { label: 'Booked'|t('booked'), url: url('booked/schedules') },
    { label: 'Schedules'|t('booked'), url: url('booked/schedules') },
    { label: title }
] %}

{% block content %}
    <form method="post" accept-charset="UTF-8">
        {{ csrfInput() }}
        <input type="hidden" name="action" value="booked/cp/schedules/save">
        {% if schedule.id %}
            <input type="hidden" name="elementId" value="{{ schedule.id }}">
        {% endif %}

        <div class="fields">
            {{ forms.textField({
                label: 'Title'|t('booked'),
                id: 'title',
                name: 'title',
                value: schedule.title,
                placeholder: 'e.g., Morning Shift, Weekend Hours'|t('booked'),
                errors: schedule.getErrors('title'),
                instructions: 'Optional: Give this schedule a descriptive name'|t('booked')
            }) }}

            {{ forms.elementSelectField({
                label: 'Service'|t('booked'),
                id: 'serviceId',
                name: 'serviceId',
                elementType: 'fabian\\booked\\elements\\Service',
                sources: '*',
                elements: schedule.serviceId and schedule.getService() ? [schedule.getService()] : [],
                limit: 1,
                required: true,
                errors: schedule.getErrors('serviceId'),
                instructions: 'Select the service this schedule applies to'|t('booked')
            }) }}

            {{ forms.elementSelectField({
                label: 'Employee'|t('booked'),
                id: 'employeeId',
                name: 'employeeId',
                elementType: 'fabian\\booked\\elements\\Employee',
                sources: '*',
                elements: schedule.employeeId and schedule.getEmployee() ? [schedule.getEmployee()] : [],
                limit: 1,
                required: false,
                errors: schedule.getErrors('employeeId'),
                instructions: 'Select the employee for this schedule (optional)'|t('booked')
            }) }}

            {{ forms.elementSelectField({
                label: 'Location'|t('booked'),
                id: 'locationId',
                name: 'locationId',
                elementType: 'fabian\\booked\\elements\\Location',
                sources: '*',
                elements: schedule.locationId and schedule.getLocation() ? [schedule.getLocation()] : [],
                limit: 1,
                required: false,
                errors: schedule.getErrors('locationId'),
                instructions: 'Select the location for this schedule (optional)'|t('booked')
            }) }}

            {{ forms.checkboxGroupField({
                label: 'Days of Week'|t('booked'),
                id: 'daysOfWeek',
                name: 'daysOfWeek',
                options: daysOfWeek,
                values: schedule.daysOfWeek,
                required: true,
                errors: schedule.getErrors('daysOfWeek'),
                instructions: 'Select one or more days for this schedule'|t('booked')
            }) }}

            <div class="flex">
                {{ forms.textField({
                    label: 'Start Time'|t('booked'),
                    id: 'startTime',
                    name: 'startTime',
                    type: 'time',
                    value: schedule.startTime,
                    errors: schedule.getErrors('startTime'),
                    instructions: 'Start time for this schedule'|t('booked')
                }) }}

                {{ forms.textField({
                    label: 'End Time'|t('booked'),
                    id: 'endTime',
                    name: 'endTime',
                    type: 'time',
                    value: schedule.endTime,
                    errors: schedule.getErrors('endTime'),
                    instructions: 'End time for this schedule'|t('booked')
                }) }}
            </div>

            {{ forms.lightswitchField({
                label: 'Enabled'|t('app'),
                id: 'enabled',
                name: 'enabled',
                on: schedule.enabled ?? true
            }) }}
        </div>

        <div class="buttons">
            <button type="submit" class="btn submit">{{ schedule.id ? 'Update'|t('app') : 'Create'|t('app') }}</button>
            <a class="btn" href="{{ url('booked/schedules') }}">{{ 'Cancel'|t('app') }}</a>
        </div>
    </form>
{% endblock %}
