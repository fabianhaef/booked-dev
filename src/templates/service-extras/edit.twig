{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set selectedSubnavItem = 'service-extras' %}
{% set title = isNew ? "New Add-On"|t('booked') : extra.title %}

{% set crumbs = [
    { label: "Booked"|t('booked'), url: url('booked') },
    { label: "Add-Ons"|t('booked'), url: url('booked/service-extras') }
] %}

{% set fullPageForm = true %}

{% block content %}
    <input type="hidden" name="action" value="booked/cp/service-extra/save">
    {% if extra.id %}
        <input type="hidden" name="elementId" value="{{ extra.id }}">
    {% endif %}

    <div id="fields">
        {{ forms.lightswitchField({
            label: 'Enabled'|t('app'),
            id: 'enabled',
            name: 'enabled',
            on: extra.enabled ?? true
        }) }}

        {{ forms.textField({
            label: "Name"|t('booked'),
            instructions: "The name of this add-on (e.g., 'Extended Session +30min', 'Premium Products')"|t('booked'),
            id: 'title',
            name: 'title',
            value: extra.title,
            errors: extra.getErrors('title'),
            autofocus: true,
            required: true
        }) }}

        {{ forms.textareaField({
            label: "Description"|t('booked'),
            instructions: "Optional description shown to customers during booking"|t('booked'),
            id: 'description',
            name: 'description',
            value: extra.description,
            errors: extra.getErrors('description'),
            rows: 3
        }) }}

        <hr>

        <div class="field">
            <div class="heading">
                <label for="price">{{ "Price"|t('booked') }}</label>
                <div class="instructions">
                    <p>{{ "Additional cost for this add-on"|t('booked') }}</p>
                </div>
            </div>
            <div class="input ltr">
                <div class="flex">
                    <div class="textwrapper">
                        <span class="currency-symbol">{{ craft.app.locale.getCurrencySymbol(craft.booked.currency) }}</span>
                    </div>
                    {{ forms.text({
                        id: 'price',
                        name: 'price',
                        value: extra.price,
                        type: 'number',
                        step: '0.01',
                        min: '0',
                        size: 10
                    }) }}
                </div>
            </div>
        </div>

        {{ forms.textField({
            label: "Additional Duration (minutes)"|t('booked'),
            instructions: "How many minutes this add-on adds to the appointment (0 = no additional time)"|t('booked'),
            id: 'duration',
            name: 'duration',
            value: extra.duration,
            type: 'number',
            min: 0,
            size: 10
        }) }}

        <hr>

        {{ forms.textField({
            label: "Maximum Quantity"|t('booked'),
            instructions: "Maximum number of this add-on allowed per booking"|t('booked'),
            id: 'maxQuantity',
            name: 'maxQuantity',
            value: extra.maxQuantity,
            type: 'number',
            min: 1,
            size: 10
        }) }}
    </div>
{% endblock %}

{% css %}
.currency-symbol {
    padding: 0 8px;
    background: #f9f9f9;
    border: 1px solid #ccc;
    border-right: none;
    border-radius: 3px 0 0 3px;
    line-height: 28px;
    display: inline-block;
}
{% endcss %}
