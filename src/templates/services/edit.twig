{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set selectedSubnavItem = 'services' %}
{% set title = service.id ? 'Edit Service'|t('booked') : 'New Service'|t('booked') %}
{% set crumbs = [
    { label: 'Booked'|t('booked'), url: url('booked/services') },
    { label: 'Services'|t('booked'), url: url('booked/services') },
    { label: title }
] %}

{% set fullPageForm = true %}

{% block content %}
    <input type="hidden" name="action" value="booked/cp/services/save">
    {% if service.id %}
        <input type="hidden" name="elementId" value="{{ service.id }}">
    {% endif %}

    <div id="fields">
        {{ forms.textField({
            label: 'Title'|t('app'),
            id: 'title',
            name: 'title',
            value: service.title,
            required: true,
            autofocus: true,
            errors: service.getErrors('title')
        }) }}

        {{ forms.textField({
            label: 'Slug'|t('app'),
            id: 'slug',
            name: 'slug',
            value: service.slug,
            errors: service.getErrors('slug'),
            instructions: 'Auto-generated from title. You can edit it manually if needed.'|t('booked')
        }) }}

        <div class="flex">
            {{ forms.textField({
                label: 'Duration (minutes)'|t('booked'),
                id: 'duration',
                name: 'duration',
                type: 'number',
                value: service.duration,
                size: 5,
                errors: service.getErrors('duration'),
                instructions: 'Service duration in minutes'
            }) }}

            {{ forms.textField({
                label: 'Price'|t('booked'),
                id: 'price',
                name: 'price',
                type: 'number',
                step: '0.01',
                value: service.price,
                size: 10,
                errors: service.getErrors('price'),
                instructions: 'Service price'
            }) }}
        </div>

        <div class="flex">
            {{ forms.textField({
                label: 'Buffer Before (minutes)'|t('booked'),
                id: 'bufferBefore',
                name: 'bufferBefore',
                type: 'number',
                value: service.bufferBefore,
                size: 5,
                errors: service.getErrors('bufferBefore'),
                instructions: 'Buffer time before service starts'
            }) }}

            {{ forms.textField({
                label: 'Buffer After (minutes)'|t('booked'),
                id: 'bufferAfter',
                name: 'bufferAfter',
                type: 'number',
                value: service.bufferAfter,
                size: 5,
                errors: service.getErrors('bufferAfter'),
                instructions: 'Buffer time after service ends'
            }) }}
        </div>

        {{ forms.lightswitchField({
            label: 'Enabled'|t('app'),
            id: 'enabled',
            name: 'enabled',
            on: service.enabled ?? true
        }) }}
    </div>
{% endblock %}

{% js %}
    // Auto-generate slug from title (like Craft entries)
    (function() {
        const $titleInput = $('#title');
        const $slugInput = $('#slug');
        let slugManuallyEdited = false;

        // Track if user manually edits slug
        $slugInput.on('input', function() {
            slugManuallyEdited = true;
        });

        // Auto-update slug from title (only if not manually edited)
        $titleInput.on('input', function() {
            if (!slugManuallyEdited || !$slugInput.val()) {
                const title = $titleInput.val();
                if (title) {
                    // Simple slug generation (Craft will handle proper slug generation server-side)
                    const slug = title.toLowerCase()
                        .replace(/[^\w\s-]/g, '') // Remove special chars
                        .replace(/\s+/g, '-')     // Replace spaces with hyphens
                        .replace(/-+/g, '-')       // Replace multiple hyphens with single
                        .trim();
                    $slugInput.val(slug);
                }
            }
        });
    })();
{% endjs %}

