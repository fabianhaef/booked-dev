{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set selectedSubnavItem = 'employees' %}
{% set title = employee.id ? 'Edit Employee'|t('booked') : 'New Employee'|t('booked') %}
{% set crumbs = [
    { label: 'Booked'|t('booked'), url: url('booked/employees') },
    { label: 'Employees'|t('booked'), url: url('booked/employees') },
    { label: title }
] %}

{% block content %}
    <form method="post" accept-charset="UTF-8">
        {{ csrfInput() }}
        <input type="hidden" name="action" value="booked/cp/employees/save">
        {% if employee.id %}
            <input type="hidden" name="elementId" value="{{ employee.id }}">
        {% endif %}

        <div class="fields">
            {{ forms.textField({
                label: 'Title'|t('app'),
                id: 'title',
                name: 'title',
                value: employee.title,
                required: true,
                autofocus: true,
                errors: employee.getErrors('title')
            }) }}

            {{ forms.textField({
                label: 'Slug'|t('app'),
                id: 'slug',
                name: 'slug',
                value: employee.slug,
                errors: employee.getErrors('slug')
            }) }}

            {{ forms.selectField({
                label: 'User'|t('booked'),
                id: 'userId',
                name: 'userId',
                options: [{ value: '', label: 'Select User'|t('booked') }]|merge(users|map(u => { value: u.id, label: u.name ?? u.email })),
                value: employee.userId,
                errors: employee.getErrors('userId'),
                instructions: 'Link this employee to a Craft user account'
            }) }}

            {{ forms.elementSelectField({
                label: 'Location'|t('booked'),
                id: 'locationId',
                name: 'locationId',
                elementType: 'fabian\\booked\\elements\\Location',
                elements: employee.locationId ? [employee.getLocation()] : [],
                limit: 1,
                errors: employee.getErrors('locationId'),
                instructions: 'Primary location for this employee'
            }) }}

            {{ forms.lightswitchField({
                label: 'Enabled'|t('app'),
                id: 'enabled',
                name: 'enabled',
                on: employee.enabled ?? true
            }) }}

            {% if employee.getFieldLayout() %}
                <hr>
                {% set fieldsLocation = 'fields' %}
                {{ employee.getFieldLayout().createForm(employee, fieldsLocation).render()|raw }}
            {% endif %}
        </div>

        <div class="buttons">
            <button type="submit" class="btn submit">{{ employee.id ? 'Update'|t('app') : 'Create'|t('app') }}</button>
            <a class="btn" href="{{ url('booked/employees') }}">{{ 'Cancel'|t('app') }}</a>
        </div>
    </form>
{% endblock %}

